struct PSINPUT {
	float4 position : SV_POSITION;
    float4 texcoord : TEXCOORD0;
};

cbuffer ConstBuffer : register(b0) {
    uint  atlas_w;
    uint  atlas_h;
    float maxtime;
    uint  _offset;
};

Texture2D shaderTexture : register(t0);
SamplerState SampleType : register(s0);


float4 pmain(PSINPUT psin) : SV_Target0 {

    float lifetime = psin.texcoord.z;
    float delta = 1.0 - (lifetime / maxtime);

    
    float2 uv = psin.texcoord.xy + 0.5; // Convert (-0.5 - 0.5) -> (0, 1)
    uv.y = -uv.y;

	float a = 1.0 / atlas_w;
	float b = 1.0 / atlas_h;
	int texture_id = int(delta * atlas_w*atlas_h);
	int x = texture_id % atlas_w;
	int y = texture_id / atlas_w;
	
	float u = a * x;
	float v = b * y;
	
	uv.x = u + (uv.x * a);
	uv.y = v + (uv.y * b);

    return shaderTexture.Sample(SampleType, uv);

}